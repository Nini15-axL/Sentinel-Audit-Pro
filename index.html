<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sentinel Audit Pro</title>
<style>
/* styles courts — adapte si besoin */
body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f5;color:#0B1E3F;margin:0;padding:20px}
.container{max-width:820px;margin:0 auto;background:#fff;padding:20px;border-radius:8px}
label{display:block;margin:10px 0 5px}
input,select{width:100%;padding:10px;border-radius:6px;border:1px solid #ccc}
.paypal-row{margin-top:15px}
.btn{background:#1A73E8;color:#fff;padding:12px;border-radius:6px;text-align:center;display:inline-block;text-decoration:none}
</style>
</head>
<body>
<div class="container">
  <h1>Sentinel Audit Pro</h1>
  <p>Choisissez un pack et payez en toute sécurité.</p>

  <label for="name">Nom / Entreprise</label>
  <input id="name" type="text" placeholder="Ex: Dupont SARL" />

  <label for="email">Email</label>
  <input id="email" type="email" placeholder="client@exemple.com" />

  <label for="domain">Domaine / Site web</label>
  <input id="domain" type="url" placeholder="https://monsite.com" />

  <label for="pack">Choix du pack</label>
  <select id="pack">
    <option value="">-- Sélectionner --</option>
    <option value="express">Pack Express — 250</option>
    <option value="pro">Pack Pro — 500</option>
    <option value="premier_250">Premier — 250€/mois</option>
    <option value="premier_300">Premier — 300€/mois</option>
    <option value="premier_500">Premier — 500€/mois</option>
    <option value="premier_900">Premier — 900€/mois</option>
  </select>

  <div class="paypal-row" id="paypal-button-container"></div>
  <p id="msg" style="color:green"></p>
</div>

<!-- PayPal SDK (live client-id) -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=EUR"></script>
<script>
const appsScriptUrl = 'YOUR_APPS_SCRIPT_URL'; // <-- remplacer par ton URL Apps Script déployé (voir plus bas)

function getAmountFromPack(pack){
  if(pack==='express') return '250';
  if(pack==='pro') return '500';
  if(pack==='premier_250') return '250';
  if(pack==='premier_300') return '300';
  if(pack==='premier_500') return '500';
  if(pack==='premier_900') return '900';
  return '0';
}

paypal.Buttons({
  createOrder: function(data, actions) {
    const pack = document.getElementById('pack').value;
    const amount = getAmountFromPack(pack);
    if(amount==='0'){ alert('Choisissez un pack'); return; }
    // créer ordre PayPal côté client (sera capturé côté serveur)
    return actions.order.create({
      purchase_units: [{ amount: { value: amount } }]
    });
  },
  onApprove: function(data, actions) {
    // capture côté client pour UX, mais on vérifiera côté serveur
    return actions.order.capture().then(function(details){
      // Collecte infos client
      const payload = {
        orderID: data.orderID,
        payerID: data.payerID || '',
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        domain: document.getElementById('domain').value,
        pack: document.getElementById('pack').value
      };
      document.getElementById('msg').textContent = 'Traitement du paiement et génération du rapport...';
      // Envoi au backend Apps Script
      fetch(appsScriptUrl + '/processOrder', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      })
      .then(r=>r.json())
      .then(resp=>{
        if(resp && resp.status === 'ok'){
          document.getElementById('msg').textContent = 'Rapport envoyé par email — vérifiez votre boîte !';
        } else {
          document.getElementById('msg').textContent = 'Erreur serveur: ' + (resp.error || 'Voir console');
          console.error(resp);
        }
      })
      .catch(err=>{
        console.error(err);
        document.getElementById('msg').textContent = 'Erreur réseau, réessayer plus tard.';
      });
    });
  },
  onError: function(err){ console.error(err); alert('Erreur PayPal'); }
}).render('#paypal-button-container');
</script>
</body>
</html>
